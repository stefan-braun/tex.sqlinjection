%!TEX root = ../document.tex
\documentclass[oneside,11pt,DIV=8,headings=openright]{scrreprt}
\usepackage{scrhack}
\usepackage[utf8]{inputenc}
\usepackage[ngerman]{babel}
%\usepackage[default]{droidserif}
%\usepackage{FiraSans}
\usepackage{setspace}
\usepackage[activate={true,nocompatibility},letterspace=60]{microtype}
\usepackage[T1]{fontenc}
\usepackage[usenames,dvipsnames,svgnames,table]{xcolor}
\usepackage[letterpaper,left=1in,top=1in,headsep=2\baselineskip,textwidth=26pc,marginparsep=2pc,marginparwidth=12pc,textheight=44\baselineskip,headheight=\baselineskip]{geometry}
\usepackage{blindtext}
\usepackage{amsmath}
\usepackage[scaled=.98,sups,osf]{XCharter}% lining figures in math, osf in text
\usepackage[scaled=1.04,varqu,varl]{inconsolata}% inconsolata typewriter
\usepackage[type1]{cabin}% sans serif
\usepackage[libertine,bigdelims,vvarbb,scaled=1.07]{newtxmath}
\usepackage[cal=boondoxo]{mathalfa}
\linespread{1.04}


%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%tikz
\def\pgfsysdriver{pgfsys-pdftex.def} %for texlive 2016
\usepackage{tikz}
\usetikzlibrary{positioning}
\usetikzlibrary{arrows,patterns}
\usetikzlibrary{shapes.geometric, arrows}
\usetikzlibrary{calc}
\usetikzlibrary{shadows.blur}
\usepackage{tikz-3dplot}
\definecolor{Gray}{HTML}{444444}
\definecolor{myGray}{HTML}{23373b}
\usetikzlibrary{arrows.meta}

\usetikzlibrary{
    shapes,
    shapes.symbols}

\usepackage{pgfplots}
\usepackage{pgfplotstable}
\pgfplotsset{compat=newest}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%


%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% Big letters at the beginning of a chapter
\usepackage{lettrine}
\renewcommand{\LettrineFontHook}{\titlefont\color{black}\rmfamily}
\setlength{\DefaultNindent}{0pt}
\setlength{\DefaultFindent}{4pt}
%\renewcommand{\LettrineFontHook}{\fontfamily{bch}}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%bib
\usepackage[backend=biber,style=alphabetic,hyperref=true,backref=true,block=none,maxcitenames=3,maxbibnames=100]{biblatex}
\addbibresource{imports/references.bib}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%


%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%minted
\usepackage[newfloat]{minted}
\usemintedstyle{manni}
\setminted{tabsize=4}
% \setminted{xleftmargin=-2em}
% \setminted{obeytabs}
\setminted{linenos,frame=lines, framesep=\fboxsep, rulecolor=\color{gray!40}}
\setminted{bgcolor=dhscodebg}
\setmintedinline{breaklines}
\setmintedinline{bgcolor={}}
% \renewcommand{\theFancyVerbLine}{\sffamily\textcolor{documentColor!80}{\scriptsize\oldstylenums{\arabic{FancyVerbLine}}}}
\makeatletter
\patchcmd{\minted@colorbg}{\noindent}{\medskip\noindent}{}{}
\apptocmd{\endminted@colorbg}{\par\medskip\vspace{-.7\baselineskip}}{}{}
\makeatother
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%


%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%Tables
\definecolor{lightGray}{RGB}{150, 150, 150}
\usepackage{array}
\usepackage{tabu}
\usepackage{longtable}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%


%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% colors
\definecolor{tableHeaderText}{RGB}{255,255, 255}
\definecolor{tableHeader}{RGB}{211, 47, 0}
\definecolor{listingbackground}{HTML}{F4F4F4}
\definecolor{dhscodebg}{rgb}{0.97,0.97,0.97}
\definecolor{mySteelBlue}{HTML}{2A4E6C}
\definecolor{tableLineOne}{RGB}{245, 245, 245}
\definecolor{tableLineTwo}{RGB}{224, 224, 224}
\definecolor{THI-Blue}{RGB}{1,90,156}
\definecolor{darkred}{rgb}{0.70, 0.0, 0.0}
\colorlet{BLACK}{black}
\colorlet{documentColor}{cyan}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%


%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%Titel
\title{Netzwerkforensik: Erkennung von SQL-Injections}
%\publishers{TH Ingolstadt}
\subtitle{Master Informatik}
\subject{Computerforensik}

\author{Stefan Braun \\
\begin{tabular}{rl}
 Matrikel & \emph{42482} \\
Prüfer & \emph{Prof. Dr. Stefan Hahndel}
\end{tabular}
}
\date{15. Juli 2016}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%


%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% Section font settings
\addtokomafont{chapter}{\normalfont\sffamily\Huge\leavevmode\color{documentColor}\lsstyle}
\addtokomafont{section}{\normalfont\sffamily\leavevmode\color{documentColor}}
\addtokomafont{subsection}{\normalfont\sffamily\leavevmode\color{documentColor}}
\addtokomafont{subsubsection}{\normalfont\sffamily\leavevmode\color{documentColor}}
\addtokomafont{paragraph}{\normalfont\sffamily\leavevmode\color{documentColor}}
\addtokomafont{title}{\normalfont\sffamily\leavevmode\color{documentColor}}
\addtokomafont{captionlabel}{\bfseries\sffamily\leavevmode\color{documentColor}}
\addtokomafont{pageheadfoot}{\footnotesize\normalfont\sffamily\leavevmode\color{black!55}\scshape}
\addtokomafont{pagenumber}{\footnotesize\normalfont\sffamily\leavevmode\color{black!55}}
\addtokomafont{caption}{\sffamily\footnotesize\leavevmode\color{black!67}}
\newlength{\chapternumberskip}
\setlength{\chapternumberskip}{\textwidth+\marginparsep+0.5\marginparwidth+2cm}
 % \renewcommand*{\chapterformat}{   \rlap{\makebox[\chapternumberskip][r]{\fontsize{60}{68}\fontseries{t}\selectfont\color{black!50}\raisebox{-0.35em}{\thechapter\autodot}}}}
 \renewcommand*{\chapterformat}{\hspace*{\marginparsep}{\fontsize{64}{70}\fontencoding{U}\fontfamily{eur}\fontseries{b}\selectfont\leavevmode\color{black!50}\thechapter\autodot}}
\RedeclareSectionCommand[afterskip=2\baselineskip, beforeskip=1sp minus 1sp]{chapter}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%


\usepackage{url}
\makeatletter
\g@addto@macro{\UrlBreaks}{\UrlOrds}
\makeatother
%csquotes after minted
\usepackage{csquotes}


%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% caption
\usepackage[labelsep=colon]{caption}
% \DeclareCaptionLabelSeparator{newlinesep}{ \\ }
% \captionsetup{
%   labelsep=newlinesep
% }

% feste Länge für das leerzeichen zwischen label und nummer
\DeclareCaptionLabelFormat{constantsep}{\bothIfFirst{#1}{\,}#2}
\captionsetup{labelformat=constantsep}
\usepackage{mcaption}
\usepackage{float}
\usepackage{ragged2e}
\captionsetup{format=plain}
\captionsetup[margincap]{indention=0pt,justification=justified}

% \renewcommand{\thetable}{\alph{table}}
% \renewcommand{\thefigure}{\alph{figure}}
% \DeclareCaptionLabelFormat{nonamecap}{\MakeUppercase{#2}}
% \captionsetup{labelformat=nonamecap}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%


%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% marginnotes
\usepackage{marginnote}
% \renewcommand{\raggedleftmarginnote}{\justified}
% \renewcommand{\raggedrightmarginnote}{\justified}
\newcommand\mymarginnote[2][0pt]{%
\marginnote{% needs marginnote package
    \lineskiplimit=-\maxdimen%
    \normalfont\sffamily\footnotesize\color{black!70}%
    \justify
    \noindent
    #2
    }[#1]%
}

\newcommand\minipagefootnotefix{\normalfont\sffamily\footnotesize\color{black!70}}
\newcommand\minipagefootnote[1]{\oldfootnote{\minipagefootnotefix #1}}

\newcommand\myothermarginnote[2][0pt]{%
\let\oldfootnote\footnote%
\let\footnote\minipagefootnote%
\marginpar{% needs marginnote package
    \begin{minipage}{\marginparwidth}
    \lineskiplimit=-\maxdimen%
    \normalfont\sffamily\footnotesize\color{black!70}%
    \justify
    \noindent
    \vspace{#1}\\
    {#2}
    \end{minipage}
    }%
\let\footnote\oldfootnote%
}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%


%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% Logo in title
\usepackage{eso-pic}
\newcommand\BackgroundPic{%
\put(0,-180){%
\parbox[b][\paperheight]{\paperwidth}{%
\vfill
\centering
\includegraphics[width=0.3\paperwidth,height=\paperheight,%
keepaspectratio]{imports/thi_logo.eps}
\vfill
}}}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%


\setlength{\emergencystretch}{0.5em}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% section numbers in margin
% \renewcommand\sectionlinesformat[4]{%
%   \makebox[0pt][r]{#3}#4%
% }
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%


%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% Header
\usepackage[automark]{scrlayer-scrpage}
\clearpairofpagestyles
% % only chapters
% \automark{chapter}
% \automark*{section}
\pagestyle{headings}

% page number on top
\newlength{\ruleWidth}
\setlength{\ruleWidth}{1.5pt}
\newlength{\pageNumperSpace}
\setlength{\pageNumperSpace}{20pt}
\newlength{\pageNumberHeaderSkip}
\setlength{\pageNumberHeaderSkip}{-\marginparwidth-\marginparsep-12pt}
\newlength{\chapterHeaderSkip}
\setlength{\chapterHeaderSkip}{\pageNumberHeaderSkip+0.5em+\pageNumperSpace+\ruleWidth}
% \ohead{\headmark~~~{\color{documentColor}\rule[-0.2em]{1.5pt}{1.2em}}~~~\pagemark\hspace*{-4.5cm}}


% \ohead{{\headmark~~~\color{documentColor}{\rule[-4pt]{\ruleWidth}{\voffset+\topmargin+\headheight+1in}}}\makebox[\pageNumperSpace][c]{\oldstylenums\pagemark}\hspace{\pageNumberHeaderSkip}}

\rohead{\smash{\textcolor{documentColor}{\rule[-4pt]{\ruleWidth}{\voffset+\topmargin+\headheight+1in}}}\makebox[\pageNumperSpace][c]{\oldstylenums\pagemark}\hspace{\pageNumberHeaderSkip}}
\lehead{\hspace{\pageNumberHeaderSkip}\makebox[\pageNumperSpace][c]{\oldstylenums\pagemark}\smash{\textcolor{documentColor}{\rule[-4pt]{\ruleWidth}{\voffset+\topmargin+\headheight+1in}}}}
\cohead{\raggedleft{\textls[100]{\headmark}} \hspace{\chapterHeaderSkip}}
\cehead{\hspace{\chapterHeaderSkip} \raggedright{\headmark} }
% no chapter number in header
\renewcommand*{\chaptermarkformat}{}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\usepackage[colorlinks, linkcolor = mySteelBlue, citecolor = mySteelBlue, filecolor = mySteelBlue, urlcolor = mySteelBlue]{hyperref}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% begin of the document
\AtBeginDocument{
%settings for flat tables
\everyrow{\tabucline[.4mm  white]{}}
\taburowcolors[2] 2{tableLineOne .. tableLineTwo}
\tabulinesep = ^3mm_2mm

\nocite{*}

% colors
\colorlet{tableHeader}{documentColor}

%title page
\input{imports/titlepage_2.tex}
% tufte geomtery
\newgeometry{left=24.8mm,top=27.4mm,headsep=2\baselineskip,textwidth=127mm,marginparsep=8mm,marginparwidth=48mm,textheight=43\baselineskip,headheight=\baselineskip}
% marginnote requires to update the textwidth after newgeometry
\edef\marginnotetextwidth{\the\textwidth}
}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%


\makeatletter


\renewcommand\chapterlinesformat[3]{%
    % \begin{tikzpicture}[remember picture,overlay]
    %     \fill[documentColor!20] ($(current page.north) + (-8,0)$) -- ($(current page.45) + (0,1.3)$) -- ($(current page.45) + (0,4)$) -- cycle ;
    %     \fill[documentColor!50] ($(current page.north) + (-5,0)$) -- ($(current page.45) + (0,1.1)$) -- ($(current page.45) + (0,4)$) -- cycle ;
    %     \fill[documentColor] (current page.north) -- ($(current page.45) + (0,0.8)$) -- ($(current page.45) + (0,4)$) -- cycle ;
    % \end{tikzpicture}
    \parbox[t]{\textwidth}{\raggedchapter\scshape{#3}}%
    \vspace*{1cm}
    \hspace*{\textwidth}\mbox{#2}

    \vspace*{-2.8cm}
}

\makeatother

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% TOC
\usepackage{titletoc,etoolbox,framed}
\patchcmd{\tableofcontents}{\contentsname}{\sffamily\contentsname}{}{}

\renewenvironment{leftbar}
  {\def\FrameCommand{\hspace{6em}%
    {\color{black!70}\vrule width 2pt depth 6pt}\hspace{1em}}%
    \MakeFramed{\parshape 1 0cm \dimexpr\textwidth-6em\relax\FrameRestore}\vskip2pt%
  }
 {\endMakeFramed}

\titlecontents{chapter}
  [0em]{\vspace*{2\baselineskip}}
  {\parbox{4.5em}{%
    \hfill\Huge\sffamily\bfseries\color{documentColor}\thecontentslabel}%
   \vspace*{-2.3\baselineskip}\leftbar\MakeUppercase{\sffamily\color{black!60}\small Seite~\thecontentspage}\\\sffamily}
  {}{\endleftbar}
\titlecontents{section}
  [8.4em]
  {\sffamily\contentslabel{3em}}{}{}
  {\hspace{0.5em}\nobreak\itshape\color{documentColor}\contentspage}
\titlecontents{subsection}
  [8.4em]
  {\sffamily\contentslabel{3em}}{}{}
  {\hspace{0.5em}\nobreak\itshape\color{documentColor}\contentspage}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%




% Listing statt Abbildung in listoflistings
\usepackage{etoolbox}
\addto\captionsngerman{%
  \renewcommand{\listlistingname}{Quellcodeverzeichnis}% <--- ??
  \renewcommand{\listingname}{Listing}% <--- ??
}
\makeatletter
\let\l@listing\l@figure
\patchcmd{\l@listing}{\cftfigpresnum}{\cftlistingpresnum}{}{}
\newcommand\cftlistingpresnum{\listingname~}
\makeatother
\KOMAoption{listof}{nochaptergap}
\KOMAoption{listof}{nonumberline}