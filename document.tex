%!TEX options = --shell-escape
\input{imports/def}

\begin{document}

\tableofcontents
\chapter{SQL-Injections im Jahr 2016}

\mymarginnote[-2em]{Derzeit werden Daten für die kommende OWASP Top Ten 2016 gesammelt.}
\lettrine[lines=2]{A}{}lle drei Jahre veröffentlicht das \emph{Open Web Application Security Project} -- kurz OWASP -- eine Liste der derzeit als am kritischsten eingestuften Sicherheitsrisiken in Webapplikationen. Und auch in der derzeit aktuellsten Fassung der Liste aus dem Jahr 2013 findet sich die Kategorie \enquote{Injections} auf Platz Eins wieder.

\begin{table}[ht!]
\begin{margincap}
\caption{Die ersten drei Kategorien der aktuellen OWASP Top Ten aus dem Jahr 2013, nach \texttt{www.owasp.org}}
\label{tab:owasp_top_ten}
\centering
\begin{tabu} to \textwidth {l l X<{\strut} l}
	\rowfont{\sffamily\bfseries\leavevmode\color{white}}
	\rowcolor{tableHeader}
	& & Kategorie & \\
	\rowfont{\sffamily}
	& 1 & Injection & \\
	\rowfont{\sffamily}
	& 2 & Broken Authentication & \\
	\rowfont{\sffamily}
	& 3 & Cross-Site-Scripting & \\
\end{tabu}
\end{margincap}
\end{table}

Derartige Angriffe basieren darauf, dass Benutzereingaben ungeprüft in Abfragen an LDAP"=Dienste und vor allem SQL"=Datenbanken als Parameter eingefügt werden. Entsprechend geformte Eingaben können somit die grundlegende Struktur der Anfrage manipulieren. Diese Manipulation kann Verlust der Informationsvertraulichkeit oder der Datenintegrität zur Folge haben, unter Umständen kann ein Angreifer Vollzugriff auf die zugrundeliegende Serverstruktur erhalten. Die vorliegende Arbeit konzentriert sich hierbei insbesondere auf gefährdete SQL"=Anfragen.

\section{Verhinderung von SQL"=Injections}

\mymarginnote[0em]{\enquote{Don't trust user input.}}
Es stellt sich folglich die Frage, wie derartige Angriffe verhindert werden können. Die übliche Vorgehensweise stellt hierbei die Überprüfung der vom Client übergebenen Parameter dar. Etwa könnte unter PHP ein Parameter, für den nur Ganzzahlen vorgesehen sind, per Konvertierung durch \mintinline{php}{intval()} abgesichert werden. \mymarginnote[-2em]{Diese PHP"=Funktion ersetzt beispielsweise ' durch \textbackslash'.  Dadurch wird es erschwert, das aktuelle String"=Literal im SQL"=Statement zu beenden und zusätzliche Befehle anzufügen.} Bei beliebigen Zeichenketten escaped die Funktion \mintinline{php}{mysql_real_escape_string()} bestimmte Zeichen, die einen Ausbruch aus der Abfrage erlauben können. Sicherer sind allerdings sogenannte \emph{Prepared Statements}, die die Anfrage und die zugehörigen Parameter getrennt voneinander übertragen und dadurch Injections verhindern.

Wenn also die Verhinderung von SQL"=Injections eine triviale Angelegenheit ist, weshalb bestimmen auch heutzutage Nachrichten über aktuelle, derartige Angriffe die Fachpresse? Die Gründe hierfür sind vielfältig. Möglicherweise ist veraltete Software im Einsatz oder dem Entwickler mangelt es schlicht an Vorwissen im Bereich der IT"=Sicherheit.
\mymarginnote[-3em]{Ein weiteres Beispiel könnte zugekaufte Fremdsoftware darstellen, die im eigenen Netzwerk betrieben wird.}
Ebenfalls vorstellbar ist Software, die nicht mehr geändert werden kann -- etwa weil der Aufwand zu groß wäre, keine Entwickler vorhanden sind, oder aber der zugehörige Sourcecode nicht zur Verfügung steht.

Außerdem können Queries konstruiert werden, die ein fachliches Problem zwar auf einfache Weise lösen, andererseits jedoch die Verwendung eines parametrisierten Prepared Statements unmöglich machen.

\begin{listing}[ht!]
\begin{margincap}
\begin{minted}[startinline,obeytabs]{php}
$query  = ""
    ."SELECT                        "
    ."    $choosenText AS myText,   "
    ."    name                      "
    ."FROM                          "
    ."    report                    "
    ."ORDER BY                      "
    ."    name $sorting             ";
mssql_query($query);
\end{minted}
\caption{In diesem PHP"=Code wird mit der Variable \mintinline{php}{choosenText} eine Spalte und mit \mintinline{php}{sorting} eine Sortierreihenfolge ausgewählt. In beiden Fällen können keine Parameter für Prepared Statements verwendet werden.}
\label{lst:strange_query}
\end{margincap}
\end{listing}

\section{Alternativen}
In all diesen Fällen muss die gefährdete Applikation also auf andere Art und Weise abgesichert werden. Ein gängiger Ansatz zur Realisierung einer solchen Schutzmaßnahme stellt eine vorgeschaltene Softwarekomponenta dar, welche auf Basis von Filterregeln einzelne Requests verwirft oder modifiziert. Hierzu soll zuerst ein übliches Schema einer Client"=Server"=Architektur skizziert werden.

\begin{figure}[ht!]
\begin{margincap}
\centering
\begin{tikzpicture}[every node/.style={ultra thick,draw=black!60, font=\large\sffamily\color{black!60},inner sep=8pt,text height=1.5ex,text depth=.25ex,node distance=1.2cm,}]
\node(hacker) {Hacker};
\node[right = of hacker.east, minimum width = 3pt,fill=documentColor, minimum height=3cm](firewall)  {};
\node[below =0.1cm of firewall.south,draw=none] {Firewall};


\node[right = of firewall.east](server)  {Webserver};
\node[right = of server.east](app)  {Anwendung};
\node[below = of app.south](db)  {Datenbank};


\draw[ultra thick,draw=black!60,] (hacker) -- (firewall) -- (server) -- (app) -- (db);
\end{tikzpicture}

\caption{Zugriffe auf eine Webserverapplikation passieren üblicherweise zuerst eine Firewall und werden anschließend von einem Webserver -- etwa \emph{Apache} -- zur Applikation weitergeleitet. Diese Applikation kann anschließend auf den Datenbankserver zugreifen.}
\label{img:server_arch}
\end{margincap}
\end{figure}

%TODO Logging --> passives Verhalten, um noch nicht entdeckte Schwachstellen aufzudecken

\mymarginnote[-2em]{Ein Beispiel hierfür stellen etwa \emph{Load Balancer} zur Lastverteilung auf mehrere Server dar.}
In aktuellen Webserverarchitekturen können weitere Komponenten enthalten sein, die an dieser Stelle jedoch vernachlässigt und abstrahiert werden sollen.

In dem abstrakten Schema eines Requests aus Abbildung \ref{img:server_arch} bieten sich zwei Stellen an, an welchen einzelne Parameter der Anfrage auf ihre Gefährlichkeit in Bezug auf SQL"=Injections hin untersucht werden können. Analysiert man die beispielsweise die GET und POST Parameter eines Requests noch bevor sie beim Webserver ankommt, spricht man von einer \emph{Web Application Firewall}. Alternativ können auch die Zugriffe auf den Datenbankserver selbst untersucht werden -- und zwar von einer vorgeschaltenen \emph{Datenbank"=Firewall.}\mymarginnote[-4em]{Sowohl Web Application Firewall als auch Datenbank"=Firewall stellen \emph{Intrusion Detection} Systeme dar.}

\chapter{Versuchsbeschreibung}
\end{document}